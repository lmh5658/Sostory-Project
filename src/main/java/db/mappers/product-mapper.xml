<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
	<entry key="selectProductList">
	
		SELECT *
			FROM (
			    SELECT ROWNUM RNUM, A.*
			    FROM (
			        SELECT 
			         PRODUCT_NO
			       , CATEGORY_NAME
			       , PRODUCT_NAME
			       , PRICE
			       , PATH
			    FROM TB_PRODUCT
			    JOIN TB_CATEGORY USING(CATEGORY_NO)
			    WHERE STATUS = 'Y'
			    ) A
			)
			WHERE RNUM BETWEEN ? AND ?
	</entry>
	
	<entry key="selectListCount">
		SELECT 
			   COUNT(*) COUNT
		  FROM TB_PRODUCT
	</entry>
	
	<entry key="selectProduct">
		SELECT 
		      PRODUCT_NO
		    , CATEGORY_NAME
		    , PRODUCT_NAME
		    , PRICE
		    , DISCOUNT_PRICE
		    , PATH
		FROM TB_PRODUCT
		JOIN TB_CATEGORY USING(CATEGORY_NO)
		WHERE PRODUCT_NO = ?
	</entry>
	
	<entry key="selectPaymentUser">
		SELECT 
		       USER_NO
		     , USER_ID
		FROM TB_MEMBER M
		LEFT JOIN TB_ORDER O USING(USER_NO)
		LEFT JOIN TB_PAYMENT P USING(PAYMENT_NO)
		WHERE PAYMENT_STATUS = 'Y'
	</entry>
	
	<entry key="selectQnaList">
	
		SELECT *
			FROM(
			SELECT ROWNUM RNUM, A.*
			FROM (
			SELECT
			     ANSWER_NO
			   , PRODUCT_NAME
			   , ANSWER_TITLE
			   , USER_ID
			   , TO_CHAR(ANSWER_DATE, 'yyyy/mm/dd') ANSWER_DATE
			   , ANSWER_CONTENT
			   , ANSWER_STATUS
			   , REPLY
			   , TO_CHAR(REPLY_DATE, 'yyyy/mm/dd') REPLY_DATE		   
			FROM TB_QNA_REPLY
			JOIN TB_PRODUCT USING(PRODUCT_NO)
			JOIN TB_MEMBER USING(USER_NO)
			WHERE PRODUCT_NO = ?
			 AND ANSWER_TYPE = 1
			ORDER
			  BY ANSWER_DATE DESC
			) A
			)
			WHERE RNUM BETWEEN ? AND ?

	</entry>
	
	<entry key="selectQnaCount">
		SELECT COUNT(*) COUNT
		  FROM 
		      TB_PRODUCT
		  WHERE PRODUCT_NO = ?
	</entry>
	
	<entry key="selectRecipeList">
		SELECT * FROM
			(
			SELECT ROWNUM RNUM, A.*
			FROM 
			(SELECT 
			         RECIPE_NO
			       , USER_ID
			       , PRODUCT_NAME
			       , CATEGORY_NAME
			       , RECIPE_TITLE
			       , THUMBNAIL_URL
			       , RECIPE_INTRO
			       , PRICE
                   , NVL((SELECT COUNT(LIKE_REFNO)
                        FROM TB_LIKE
                       WHERE LIKE_TYPE = 'R'
                       GROUP BY LIKE_REFNO
                        HAVING LIKE_REFNO = RECIPE_NO
                      ), 0) COUNT
			       , PATH
			       , USER_PATH
			    FROM TB_RECIPE R
			    LEFT JOIN TB_CATEGORY USING(CATEGORY_NO)
			    LEFT JOIN TB_PRODUCT USING(PRODUCT_NO)
			    LEFT JOIN TB_MEMBER USING (USER_NO)
			    WHERE PRODUCT_NO = ?
			      AND RECIPE_STATUS = 'Y'
			    ORDER
			       BY POST_DATE DESC
			)A
			)
			WHERE RNUM BETWEEN 1 AND 3
	</entry>
	
	<entry key="selectReviewCount">
		SELECT COUNT(*) COUNT
		  FROM TB_REVIEW
	</entry>
	
	<entry key="selectReviewList">
	SELECT *
		FROM(
		SELECT ROWNUM RNUM, A.*
		FROM( 
		SELECT 
		      PRODUCT_NO
		    , REVIEW_CONTENT
		    , RATING
		    , USER_ID
		    , TO_CHAR(POST_DATE, 'yyyy/MM/DD') POST_DATE
		FROM TB_REVIEW R
		LEFT JOIN TB_MEMBER M ON(M.USER_NO = R.WRITER_NO)
		WHERE R.PRODUCT_NO = ?
		ORDER 
		   BY POST_DATE DESC
		)A
		)
		WHERE RNUM BETWEEN ? AND ?
	</entry>
	
	<entry key="insertReview">
		INSERT 
		    INTO TB_REVIEW
		    (
		      PRODUCT_NO
		    , WRITER_NO
		    , RATING
		    , REVIEW_CONTENT
		    )
		    VALUES
		    (
		     ?
		    ,?
		    ,?
		    ,?
		    )
	
	</entry>
	
	<entry key="selectReview">
		SELECT 
		       REVIEW_CONTENT
		     , RATING
		     , USER_ID
		     , TO_CHAR(POST_DATE, 'yyyy/mm/dd') POST_DATE
		FROM 
		    TB_REVIEW
		LEFT JOIN TB_MEMBER ON(USER_NO = WRITER_NO)
		WHERE WRITER_NO = ?
	</entry>
	
	<entry key="searchCountList">
		SELECT COUNT(*) COUNT
		  FROM TB_PRODUCT
		 WHERE PRODUCT_NAME LIKE '%' || ? || '%'
	</entry>
	
	<entry key="selectSearchList">
		SELECT * 
			FROM(
			SELECT ROWNUM RNUM, A.*
			FROM(
			SELECT 
			      PRODUCT_NO
			    , CATEGORY_NAME
			    , PRODUCT_NAME
			    , PRICE
			    , DISCOUNT_PRICE
			    , PATH 
			FROM TB_PRODUCT
			JOIN TB_CATEGORY USING(CATEGORY_NO)
			WHERE PRODUCT_NAME LIKE '%' || ? || '%'
			  AND STATUS = 'Y'
			ORDER
			   BY ENROLL_DATE DESC
			) A
			) WHERE RNUM BETWEEN ? AND ?
	</entry>
	

</properties>
